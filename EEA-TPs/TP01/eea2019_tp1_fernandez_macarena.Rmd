---
title: "Trabajo Práctico N°1"
author: "Macarena Fernandez Urquiza"
output: html_notebook
---

## 1. Preparación de los datos (I)

 - a) Leer el archivo ar_properties.csv y mostrar su estructura

Importo la librería tidyverse.

```{r}
library(tidyverse)
library(data.table, warn.conflicts = FALSE)
library(corrr)
library(ggplot2)
library(GGally, warn.conflicts = FALSE)
```

Cargo el dataset.

```{r}
dataset = fread("ar_properties.csv")
```

Muestro la estructura de los datos. 

```{r}
summary(dataset)
```

Primero lo hago con la función summary de R base porque me muestra de qué tipo es cada variable y me calcula las medidas de posición y los faltantes de cada una. 
Pero como veo que hay variables de tipo character también y quiero ver cuáles son sus valores, de manera general, utilizo la función glimpse de la librería Tidyverse. Esta función no me muestra las medidas de posición, pero sí algunos valores y qué tipo de variable es cada una.

```{r}
glimpse(dataset)
```

l1: países
l2: ciudades o localidades
l3: barrios
l4: barrios/localidades
l5: barrios
currency: moneda

 - b) Quedarse con aquellos registros que:
     - Pertenecen a Argentina y Capital Federal
     - Cuyo precio esta en dólares (USD)
     - El tipo de propiedad sea: Departamento, PH o Casa
     - El tipo de operacion sea Venta

La especificación de Argentina debería estar en ly, y la de Capital Federal, en l2, l3 o l4. Chequeo.

```{r}
#unique(dataset$l1)
#unique(dataset$l2)
#unique(dataset$l3)
#unique(dataset$l4)
#unique(dataset$l5)

#unique(dataset$currency)

#unique(dataset$property_type)

#unique(dataset$operation_type)
```

l1 == Argentina
l2 == Capital Federal
currency == USD
property_type == Departamento PH Casa
operation_type == Venta

```{r}
dataset_venta <- dataset %>% 
  filter(l1 == 'Argentina',
         l2 == 'Capital Federal',
         currency == 'USD',
         property_type %in% c('Departamento','PH','Casa'),
         operation_type == 'Venta')
```

 - c) Seleccionar las variables id, l3, rooms, bedrooms, bathrooms, surface_total, surface_covered, price y property_type

```{r}
dataset_filtrado <- dataset_venta %>% 
  select(id, l3, rooms, bedrooms, bathrooms, surface_total, surface_covered, price, property_type)
```

Deberían llegar a un dataset con 61905 observaciones y 9 variables => ÉXITOS

## 2. Analisis exploratorios (I)

 - a) Obtener la cantidad de valores únicos y de valores faltantes (NAs) para cada una de estas variables

Cantidad de valores únicos por variable:

```{r}
unique_values <- dataset_filtrado %>% 
  summarise_all(n_distinct) #de dplyr
```

Cantidad de valores faltantes por variable:

```{r}
na_values <- dataset_filtrado %>% 
  is.na() %>% 
  colSums() %>% 
  t() %>% 
  as.data.frame()
```

 - b) Obtener la matriz de correlacion para las variables numéricas. Pista: usen ‘complete.obs’ para poder omitir los valores faltantes.

```{r}
dataset_filtrado %>% 
  select_if(is.numeric) %>% 
  correlate(use="complete.obs") %>% 
  shave() %>% 
  fashion()
```

```{r}
dataset_filtrado %>% 
  select_if(is.numeric) %>% 
  correlate(use="complete.obs")  %>% 
  rplot()
```

## 3. Preparacion de los datos (II)

 - a) En el punto 2 deberían haber encontrado que la variable bedrooms presenta una alta proporción de valores faltantes y que presenta una fuerte correlación con la variable rooms. Por lo tanto, vamos a eliminarla.

```{r}
dataset_sin_bedrooms <- dataset_filtrado %>% 
  select(-c(bedrooms))
```

 - b) Eliminar todos los registros que presentan valores faltantes

```{r}
dataset_sin_NA <- dataset_sin_bedrooms %>% 
  na.omit()
```

Deberían llegar a un dataset con 51210 observaciones y 8 variables => ÉXITO

## 4.Analisis exploratorios (II)

 - a) Obtener estadísticas descriptivas para la variable precio (cuartiles, promedio, mínimo y máximo) y realizar un histograma de la variable.
 
```{r}
dataset_sin_NA %>% 
  select(price) %>% 
  summary()

dataset_sin_NA %>% 
  summarise(Q1 = quantile(x = price, probs = 0.25, names = FALSE), 
            Q3 = quantile(x = price, probs = 0.75, names = FALSE), 
            promedio = mean(price), 
            mín = min(price), 
            máx = max(price))
```
```{r}
library(hrbrthemes)

# basic histogram
dataset_sin_NA %>% 
  ggplot(aes(x=price)) + 
  geom_histogram(fill="#69b3a2", color="#e9ecef") + 
  ggtitle("Histograma") + 
  theme_minimal()
  
```

 - b) Obtener estadísticas descriptivas para la variable precio (cuartiles, promedio, mínimo y máximo) por cada tipo de propiedad.
 
```{r}
dataset_sin_NA %>% 
  group_by(property_type) %>% 
  summarise(Q1 = quantile(x = price, probs = 0.25, names = FALSE), 
            Q3 = quantile(x = price, probs = 0.75, names = FALSE), 
            promedio = mean(price), 
            mín = min(price), 
            máx = max(price))
```

 - c) Realizar un gráfico de boxplot de la variable precio por tipo de propiedad.

Primero cambio las variables nominales a numerales discretas.

```{r}
ggdata <- dataset_sin_NA %>% 
  mutate(id = as.factor(id),
         l3 = as.factor(l3),
         property_type = as.factor(property_type))

ggplot(ggdata, aes(x = property_type, y = price, group = property_type, fill = property_type)) +
  geom_boxplot() +
  labs(title='Precio por tipo de propiedad',
       x = 'Tipos de propiedad',
       y = 'Precio (USD)') +
  scale_y_continuous(limits = c(5000, 2000000))
```

 - d) Realizar un correlagrama usando GGAlly.

```{r}
dataset_sin_NA %>% 
  select_if(is.numeric) %>%
  ggcorr(method = c("complete.obs","pearson"),
         low = '#e0f3db',
         mid = '#a8ddb5',
         high = '#43a2ca',
         label = TRUE,
         label_color = "black",
         nbreaks = 5,
         hjust = 0.75,
         legend.position = "left") +
  labs(title = "Propiedades en venta en CABA - Correlograma")

help(ggcorr)
```

## 5. Outliers

 - Eliminar los outliers de la variable precio con algún criterio que elijan: puede ser por valores de corte, eliminar el x% a izquierda y derecha,etc.
 
```{r}

```

## 6. Analisis exploratorios (III)

 - Repetir los 4 análisis exploratorios realizados en el punto 4 y realizar unos breves comentarios sobre los cambios que encontraron.
 
```{r}

```
 
## 7. Modelo lineal

 - a) Realizar un modelo lineal simple para explicar el precio en función de las habitaciones (rooms) y otro modelo que explique el precio en función de la superficie total (surface_total)

```{r}

```

 - b) Usar la función summary() para obtener informacion de ambos modelos. Explicar los valores de los coeficientes estimados.
 
```{r}

```
 
 - c) ¿Cuál modelo usarían para predecir el precio? ¿Por qué?
